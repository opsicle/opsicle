# Updates made on 13th July 2025

- [x] Fix bug where ID seemingly cannot be longer than a certain length (this is in Telegram only - button data has a maximum size of 64 characters - might need to change caching set/get mechanism to use only the request uuid or else do some fixed character hash of the request id)
  - Now using just the request UUID instead of the request ID + request UUID
- [x] Refactored utility methods for handling `Approval` and `ApprovalRequest` objects
  - Implemented the Create/Load/Update methods as class functions on them which cleans up the global package scope
- [x] Redact MFA seed value when retrieving approval requests via the HTTP service
  - Implemented a `GetRedacted` method on the `ApprovalRequest` object
- [ ] Implement a way to specify the approval mechanism in the `automations.AutomationTemplate` resource
  - [x] Refactor `approvals.TelegramRequestSpec` to be able to target multiple users and multiple channels

## Learnings

- Logging middleware in `gorilla/mux` applies only to routes, not the `NotFoundHandler`, to do that, we need to wrap the whole handler in the logging middleware
- Might wanna refactor out the logging code in the `common` http messages sending methods since it's dependent on the logging middleware being injected - some potentially leaky abstraction
- For approval requests, the request specification should indicate `which chats to send to` and `people who are authorised to respond` separately since these are separate things and we don't need person X to definitively respond in channel Y (they should be able to respond in any channel they see the notification in)

## Next time

- [ ] Implement a way to specify the approval mechanism in the `automations.AutomationTemplate` resource
  - [ ] Refactor `approvals.SlackRequestSpec` to be able to target multiple users and multiple channels
  - [x] Refactor `approvals.TelegramRequestSpec` to be able to target multiple users and multiple channels
  - [ ] Implement a `ApprovalPolicy` class as a object that can be saved into the database for referencing in the `AutomationTemplate` resource
  - [ ] Also allow a full `approvals.RequestSpec` to be defined in the `automations.AutomationTemplate`
- [ ] Create test case using example YAML for demonstrating running at `Automation` with approval requests in place
- [ ] Implement some kind of secret retrieval mechanism to retrieve username/passwords/bearer tokens/header tokens from (for webhook callbacks)
- [ ] Refactor Telegram approval/rejection so that they can share the same function similar to how the Slack implementation does it (in a "handle response" manner instead of an explicit approve/reject function with duplicate code)
- [ ] Implement effects for the `Title` field in the `RequestSpec` class
- [ ] Implement handling for the `TtlSeconds` field in the `RequestSpec` class
- [ ] Implement display of the `Url` field in the `RequestSpec` class
