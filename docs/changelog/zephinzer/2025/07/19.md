# Updates made on 19th July 2025

- [x] Fix bug in Telegram where if input length is not expected, it does not handle that on the frontend (`failed to validate totpToken[123]: Input length unexpected`)
  - [x] Treating it as a rejected MFA instead of invalid
- [x] Fix bug in Telegram where approvals without MFA do not add an entry into the `Actions` field
- [ ] Check if Slack MFA and approvals have similar bugs to what Telegram had (length wrong => error, not invalid), `Actions` not logged
- [x] Add configuration to the `approver` to allow for customisation of the server listener address
- [x] Enable BasicAuth authentication for the `approver`
- [x] Enable BearerAuth authentication for the `approver`
- [x] Enable IP allowlist for the `approver`
- [ ] Refactor the `approver` service's HTTP server so that `approver` only adds the router to the server, the server initialisation code should be in the `internal/common` package so that it can also be used by the `controller`
- [ ] Create the controller server
  - [ ] Controller server listens on a port
  - [ ] Add CLI flag `--local` mode to indicate to the CLI that it's working locally, otherwise, communicate with the controller server via `--controller-url`
  - [ ] Controller server handles endpoint `GET /automation-template` to retrieve available automation templates
  - [ ] Create CLI `opsicle get automationtemplates` that retrieves available automation templates
  - [ ] Controller server handles endpoint `POST /automation-template` to save an automation template
  - [ ] Create CLI `opsicle submit automationtemplate` that saves an automation template
  - [ ] Controller server handles endpoint `POST /automation` to run an automation template
  - [ ] Create CLI `opsicle trigger automationtemplate` that runs an automation template
  - [ ] Controller server handles endpoint `POST /approval-policy` to create an approval policy
- [ ] Implement some kind of secret retrieval mechanism to retrieve username/passwords/bearer tokens/header tokens from (for webhook callbacks)
- [ ] Refactor Telegram approval/rejection so that they can share the same function similar to how the Slack implementation does it (in a "handle response" manner instead of an explicit approve/reject function with duplicate code)
- [ ] Implement effects for the `Title` field in the `RequestSpec` class
- [ ] Implement handling for the `TtlSeconds` field in the `RequestSpec` class
  - [ ] Update approver service to check for `ttl` on any interaction and failing it
- [ ] Implement display of the `Url` field in the `RequestSpec` class
- [ ] Update `opsicle run automationtemplate` to use the filesystem queue instead of including inline logic

## Learnings

## Next time
