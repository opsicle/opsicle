# Updates made on 7th July 2025

- [x] Standardise the command context `cmdCtx` string across all CLI components so the flags don't fuckup again
- [x] Refactor HTTP endpoints to use a standardised `sendHttpFailResponse` method to declutter the code in the approver processor
- [x] Refactor HTTP methods to be in `common` package
- [x] Update `opsicle run approval` to use an approver service's URL instead of duplicating the code, the job should stop once there is a status by the approver service
- [x] Introduce possibility for multiple singleton `Notifier` instances so that we can accomodate both Slack and Telegram
- [x] Introduced new `internal/cli` for managing flags and binding to environment variables using the `init()` method for flags<>cobra.Command binding, and env<>cobra.Command.PreRun binding
- [x] Added stub for `opsicle start helper totpgenerator`

## Next time:

- [ ] Fix recurring issue with flags being overwritten by other flags by using the new `internal/cli` package's method
- [ ] Add a `totopgenerator` helper to help with verifying `mfaSeed` works
- [ ] Implement a timeout/TTL feature in the approval request creation, once timeout is reached, the approval request becomes invalid and any approval/rejection action on it will change the message to indicate that it's no longer valid
  - Perhaps implement a job that routinely updates the messages of invalid jobs
  - The expiry set on the cache should be AFTER the message's programmatically set TTL
- [ ] Add `mfaSeed` as a field for the approval request specification so that a consumer can enable MFA for approvals
